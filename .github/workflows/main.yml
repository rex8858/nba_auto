name: NBA Auto Tasks (Hybrid v4.3)

on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *'  # æ¯å¤©å°åŒ—æ—©ä¸Š 7:30 åŸ·è¡Œ (ET æ™šä¸Š 18:30)
    - cron: '0 0 * * *'    # æ¯å¤©å°åŒ—æ—©ä¸Š 8:00 å†æ¬¡æª¢æŸ¥ (ET æ™šä¸Š 19:00)

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: æª¢å‡º GitHub å°ˆæ¡ˆ
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: è¨­å®š Python ç’°å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: å®‰è£ä¾è³´å¥—ä»¶
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy pytz pyyaml requests

    - name: åŸ·è¡Œ NBA Hybrid v4.x è‡ªå‹•é æ¸¬èˆ‡å›æŠ“
      run: |
        echo "ğŸ•’ Starting NBA Hybrid v4.3 automation..."
        python main.py

    - name: è‡ªå‹•ä¸Šå‚³æ›´æ–°æª”æ¡ˆè‡³ GitHub (æ›´æ–°è³‡æ–™)
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add logs/ || true
        git commit -m "Auto update: latest run logs [Hybrid v4.3]" || echo "No changes to commit"
        git push

    - name: å»ºç«‹æ¯æ—¥ ZIP å‚™ä»½
      run: |
        mkdir -p backups
        zip -r backups/nba_auto_backup_$(date +'%Y%m%d_%H%M').zip data logs
        git add backups/ || true
        git commit -m "Add daily backup zip [Hybrid v4.3]" || echo "No new backups"
        git push

