name: NBA Auto Tasks (Hybrid v4.3)

on:
  schedule:
    # è‡ªå‹•é æ¸¬ï¼ˆå°åŒ— 07:30ï¼‰ â‰ˆ ET 18:30 å‰ä¸€æ—¥
    - cron: '30 23 * * *'  # UTC æ™‚é–“ï¼Œç­‰æ–¼å°åŒ— 07:30
    # è‡ªå‹•å›æŠ“ï¼ˆå°åŒ— 19:00ï¼‰ â‰ˆ ET 06:00 ç•¶æ—¥
    - cron: '00 11 * * *'  # UTC æ™‚é–“ï¼Œç­‰æ–¼å°åŒ— 19:00
  workflow_dispatch:  # æ‰‹å‹•åŸ·è¡Œ
    inputs:
      mode:
        description: 'Run mode (auto/manual)'
        required: false
        default: 'manual'

concurrency:
  group: nba_auto
  cancel-in-progress: true

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: æª¢å‡º GitHub å°ˆæ¡ˆ
        uses: actions/checkout@v3

      - name: è¨­å®š Python ç’°å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: å®‰è£ä¾è³´å¥—ä»¶
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install filelock pandas numpy requests matplotlib

      - name: åŸ·è¡Œ NBA Hybrid v4.x è‡ªå‹•é æ¸¬èˆ‡å›æŠ“
        run: |
          echo "ğŸ€ Starting NBA Hybrid v4.3 automation..."
          python main.py
          echo "âœ… Task completed."

      - name: è‡ªå‹•ä¸Šå‚³æ›´æ–°æª”æ¡ˆè‡³ GitHubï¼ˆæ›´æ–°è³‡æ–™ï¼‰
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add data/ logs/ || true
          git commit -m "Auto update: latest predictions and results [Hybrid v4.3]" || echo "No changes"
          git push

      - name: å»ºç«‹æ¯æ—¥ ZIP å‚™ä»½
        run: |
          mkdir -p backups
          zip -r "backups/nba_auto_backup_$(date +'%Y%m%d').zip" data/ logs/ || true
          git add backups/ || true
          git commit -m "Add daily backup zip [Hybrid v4.3]" || echo "No new backup"
          git push
